
 

<mat-card class="form-card">
  <mat-card-title class="form-title">表单学习页面</mat-card-title>
  <!-- <div class="title-underline"></div> 独立的蓝线，更好控间距 -->
  <mat-card-content>
<form [formGroup]="form" (ngSubmit)="submit()" class="form-grid">

  <!-- 文本输入 -->
  <mat-form-field appearance="outline">
    <mat-label>姓名</mat-label>
    <input matInput placeholder="请输入姓名" formControlName="name">
    <mat-error *ngIf="submitted && form.controls.name.errors?.['required']">姓名必填</mat-error>
    <mat-error *ngIf="submitted && form.controls.name.errors?.['minlength']">至少 2 个字符</mat-error>
  </mat-form-field>

  <!-- 单选：性别 -->
  <div class="field">
    <label class="field-label">性别</label>
    <mat-radio-group formControlName="gender" class="row">
      <mat-radio-button value="male">男</mat-radio-button>
      <mat-radio-button value="female">女</mat-radio-button>
    </mat-radio-group>
  </div>
<mat-form-field appearance="outline">
 <mat-label>国籍</mat-label>

  <!-- 可输入的文本框：用于搜索和显示 -->
  <input
    matInput
    [formControl]="inputCtrl"
    [matAutocomplete]="auto"
    (blur)="onCountryBlurExactMatch()"
    placeholder="输入中文/英文/代码搜索">
 <mat-error *ngIf="inputCtrl.hasError('invalidOption')">
    输入无效，请从下拉列表中选择一个有效项
  </mat-error>
  <mat-autocomplete
    #auto="matAutocomplete"
     [displayWith]="displayCountry" 
      [autoActiveFirstOption]="true"
    (optionSelected)="pick($event.option.value) 
    ">
    @for (c of (filtered$ | async); track c.code) {
      <mat-option [value]="c">
        {{ c.name_cn }} ({{ c.code }}) — {{ c.name_en }}
      </mat-option>
    } @empty {
      <mat-option disabled>无匹配结果</mat-option>
    }
  </mat-autocomplete>
</mat-form-field>
  <div>
    <label class="mb-1 block font-medium">居住地（省 / 市 / 区县）</label>

    <!-- 直接绑定到 formControlName="region" -->
    <app-region-selector
      formControlName="region"
      [required]="true">               <!-- 交给子组件做“至少选省”的必填校验 -->
    </app-region-selector>

    <!-- 校验提示（既支持父控件 required，也支持子组件的 validate()） -->
    <div class="text-red-600 text-sm mt-1"
         *ngIf="form.get('region')?.invalid && form.get('region')?.touched">
      请选择至少省份（建议选到区县）
    </div>

    <!-- 选中值预览（可选） -->
    <div class="text-gray-600 text-sm mt-1" *ngIf="form.value.region as r">
      已选代码：{{ r.provinceCode }}{{ r.cityCode ? ' / ' + r.cityCode : '' }}{{ r.countyCode ? ' / ' + r.countyCode : '' }}
    </div>
  </div>
<mat-form-field appearance="outline">
  
 <mat-label>民族</mat-label>

  <!-- 可输入的文本框：用于搜索和显示 -->
  <input
    matInput
    [formControl]="ethnicsInputCtrl"
    [matAutocomplete]="ethnicAuto"
    (blur)="onEthnicBlurExactMatch()"
    placeholder="输入你的民族">
 <mat-error *ngIf="ethnicsInputCtrl.hasError('invalidOption')">
    输入无效，请从下拉列表中选择一个有效项
  </mat-error>
  <mat-autocomplete
    #ethnicAuto="matAutocomplete"
     [displayWith]="displayEthnic" 
      [autoActiveFirstOption]="true"
    (optionSelected)="pickEthnic($event.option.value)">
    @for (c of (filteredeEthnics$ | async); track c.code) {
      <mat-option [value]="c">
        {{ c.name }} ({{ c.name_py_first}})
      </mat-option>
    } @empty {
      <mat-option disabled>无匹配结果</mat-option>
    }
  </mat-autocomplete>
</mat-form-field>
  <!-- 下拉选择：科室 -->
  <mat-form-field appearance="outline">
    <mat-label>科室</mat-label>
    <mat-select formControlName="dept">
      <mat-option *ngFor="let d of depts" [value]="d">{{ d }}</mat-option>
    </mat-select>
    <mat-error *ngIf="submitted && form.controls.dept.invalid">请选择科室</mat-error>
  </mat-form-field>

  <!-- 日期选择：生日 -->
  <mat-form-field appearance="outline">
    <mat-label>出生日期</mat-label>
    <input matInput [matDatepicker]="picker" placeholder="选择日期" formControlName="birthday">
    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-datepicker #picker></mat-datepicker>
    <mat-error *ngIf="submitted && form.controls.birthday.invalid">请选择日期</mat-error>
  </mat-form-field>

  <!-- 手机号 -->
  <mat-form-field appearance="outline">
    <mat-label>手机号</mat-label>
    <input matInput placeholder="可选项" formControlName="phone">
    <mat-hint align="end">示例：13800001234</mat-hint>
    <mat-error *ngIf="submitted && form.controls.phone.invalid">手机号格式不正确</mat-error>
  </mat-form-field>

  <!-- 自动完成（标签） -->
  <mat-form-field appearance="outline">
    <mat-label>标签（自动完成）</mat-label>
    <input
      type="text"
      matInput
      formControlName="tags"
      [matAutocomplete]="auto"
      placeholder="输入关键字试试：糖/高/过敏/..."
    >
    <mat-autocomplete #auto="matAutocomplete">
      <mat-option *ngFor="let opt of tagOptions"
                  [value]="opt">
        {{ opt }}
      </mat-option>
    </mat-autocomplete>
  </mat-form-field>

  <!-- 开关 -->
  <div class="field">
    <label class="field-label">消息通知</label>
    <mat-slide-toggle formControlName="enableNotify">开启</mat-slide-toggle>
  </div>

  <!-- 滑块 -->
  <div class="field">
    <label class="field-label">疼痛等级（0-10）</label>
    <mat-slider min="0" max="10" step="1" showTickMarks >
         <input matSliderThumb formControlName="painLevel">
    </mat-slider>
  </div>

  <!-- 勾选同意 -->
  <div class="field">
    <mat-checkbox formControlName="agree">我已阅读并同意隐私政策</mat-checkbox>
    <div class="error" *ngIf="submitted && form.controls.agree.invalid">需勾选同意</div>
  </div>

  <!-- 操作按钮 -->
  <div class="actions">
    <button mat-raised-button color="primary" type="submit">
      <mat-icon>check</mat-icon>&nbsp;提交
    </button>
    <button mat-stroked-button type="button" (click)="reset()">
      <mat-icon>refresh</mat-icon>&nbsp;重置
    </button>
  </div>
</form>
  </mat-card-content>

<!-- 提交结果展示 -->
<pre *ngIf="resultJson" class="result">{{ resultJson }}</pre>